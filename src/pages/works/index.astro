---
// layout
import Layout from "../../layouts/Layout.astro";

// components
import Heading from "../../components/elements/Heading.astro";
import Container from "../../components/elements/Container.astro";
import { Image } from "astro:assets";

// posters
import broken from "../../assets/images/broken.jpg";
import chaotic from "../../assets/images/chaotic.jpg";
import dot from "../../assets/images/dot.jpg";
import dury from "../../assets/images/dury.jpg";
import gnaal from "../../assets/images/gnaal.jpg";
import gynoid from "../../assets/images/gynoid.jpg";
import kvadrat from "../../assets/images/kvadrat.jpg";
import memory from "../../assets/images/memory.jpg";
import paeplo from "../../assets/images/paeplo.jpg";
import zevedeus from "../../assets/images/zevedeus.jpg";

const posters = [broken, chaotic, dot, dury, gnaal, gynoid, kvadrat, memory, paeplo, zevedeus];
---

<Layout title="Posters">
    <Container variant={'xl'} class="flex flex-col !gap-2 items-start">
        <nav class="flex flex-wrap gap-4 md:gap-8 justify-start">
            <a href="/" class="text-base-900 font-grunge text-3xl underline underline-offset-4 decoration-2 hover:text-base-700">Home</a>
            <a href="/works" class="text-base-900 font-grunge text-3xl underline underline-offset-4 decoration-2 hover:text-base-700">Posters</a>
            <a href="/about" class="text-base-900 font-grunge text-3xl underline underline-offset-4 decoration-2 hover:text-base-700">About</a>
            <a href="/contact" class="text-base-900 font-grunge text-3xl underline underline-offset-4 decoration-2 hover:text-base-700">Contact</a>
        </nav>
        <Heading tagName="h1" tagSize="h1" class="text-left">Posters</Heading>
        <h2 class="font-grunge text-4xl text-base-900">2025-2026</h2>
        <div class="grid lg:grid-cols-4 md:grid-cols-3 grid-cols-2 gap-8 w-full mt-2">
            {posters.map((poster, index) => (
                <div class="w-full cursor-pointer poster-thumb" data-index={index}>
                    <Image
                        src={poster}
                        alt={`Poster ${index + 1}`}
                        class="w-full h-auto object-contain hover:opacity-80 transition-opacity"
                        loading="lazy"
                    />
                </div>
            ))}
        </div>
    </Container>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-8">
        <button id="close-lightbox" class="absolute top-4 right-4 text-white text-4xl font-grunge hover:opacity-70">&times;</button>
        <img id="lightbox-img" src="" alt="Poster preview" class="max-h-[90vh] max-w-[90vw] object-contain" />
    </div>

    <script define:vars={{ posters }}>
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const closeBtn = document.getElementById('close-lightbox');
        const thumbs = document.querySelectorAll('.poster-thumb');

        // Get all poster image sources
        const posterSrcs = Array.from(thumbs).map(thumb => thumb.querySelector('img').src);

        function openLightbox(index) {
            lightboxImg.src = posterSrcs[index];
            lightbox.classList.remove('hidden');
            lightbox.classList.add('flex');
            // Push history state so back button closes lightbox
            history.pushState({ lightbox: true }, '');
        }

        function closeLightbox() {
            lightbox.classList.add('hidden');
            lightbox.classList.remove('flex');
        }

        thumbs.forEach((thumb, index) => {
            thumb.addEventListener('click', () => {
                openLightbox(index);
            });
        });

        closeBtn.addEventListener('click', () => {
            closeLightbox();
            // Go back in history to remove the lightbox state
            history.back();
        });

        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                closeLightbox();
                history.back();
            }
        });

        // Handle browser back button
        window.addEventListener('popstate', (e) => {
            if (!e.state?.lightbox) {
                closeLightbox();
            }
        });
    </script>
</Layout>
